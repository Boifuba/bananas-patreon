{"name":"Colored Borders","type":"script","scope":"global","author":"oB3qR0KsEQyl7qtK","img":"icons/magic/symbols/ring-circle-smoke-blue.webp","command":"const myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n  </style>\n  <div class=\"callheader\">Colored Borders</div>\n\n  <form>\n    <div class=\"form-group\">\n      <label>Size</label>\n      <div class=\"form-fields\">\n        <input id=\"sizes\" type=\"number\" name=\"sizes\">\n      </div>\n    </div>\n  </form>\n  <div class=\"coluna3\">\n    <form>\n      <div class=\"form-group\">\n        <label style=\"text-align: left\">Color </label>\n        <div class=\"form-fields\">\n          <select id=\"cores\" name=\"cores\">\n            <option value=\"yellow\">Yellow</option>\n            <option value=\"Pink\">Purple</option>\n            <option value=\"blue\">Blue</option>\n            <option value=\"bluewhite\">Blue White</option>\n            <option value=\"Pink\">Pink</option>\n            <option value=\"Red\">Red</option>\n            <option value=\"Orange\">Orange</option>\n            <option value=\"Red\">Red</option>\n            <option value=\"White\">White</option>\n            <option value=\"Green\">Green</option>     \n            <option value=\"sides\">Sides</option>       \n              <option value=\"cyberpunk\">Cyberpunk</option>       \n\n          </select>\n        </div>\n      </div>\n    </form>\n  </div>\n  <br>\n  <button class=\"banana-set-size\" role=\"button\">Banana</button>\n`;\n\n\nlet error = false;\n\nif (!(game.modules.get(\"sequencer\")?.active)) {\n    error = `You need to have Sequencer installed and activated to run this macro!`;\n}\nif (error) {\n    ui.notifications.error(error);\n    return;\n}\n\nconst macro = this;\nnew Dialog({\n    title: \"GURPS Instant Colored Borders\",\n    content: myContent,\n    buttons: {},\n    render: async (html) => listeners(html)\n}).render(true);\n\nasync function listeners(html) {\n    if (macro.getFlag(\"world\", \"sizes\")) html.find(\"#sizes\").val(macro.getFlag(\"world\", \"sizes\"));\n    else html.find(\"#sizes\").val(0);\n    html.click(async function (event) {\n        if (event.target.className === \"banana-set-size\") {\n            const size = html.find(\"#sizes\").val(); \n            const cor = html.find(\"#cores\").val(); \n            await macro.setFlag(\"world\", \"sizes\", size);\n            await aplica(size, cor);\n            html.find(\"#sizes\").val(size)\n        }\n    });\n}\nasync function aplica(size, cor) {\n    let token = canvas.tokens.controlled[0]\n    const effects = Sequencer.EffectManager.getEffects({\n        name: \"*bordinha*\",\n        object: token,\n    });\n    if (effects.length) {\n        console.log(\"removing effect\")\n        Sequencer.EffectManager.endEffects({ name: \"*bordinha*\", object: token });\n    }\n    else {\n        console.log(\"adding effect\", size, cor)\n        new Sequence()\n            .effect()\n            .file(`/modules/gurps-instant-defaults/packs/borders/${cor}.webm`)\n            .attachTo(token)\n            .scale(Number(size))\n            .atLocation(token)\n            .persist()\n            .name(\"bordinha\")\n            .elevation(0)\n            .play();\n    }\n}","ownership":{"default":0,"1wvFEddoeqrS4gB1":3,"oB3qR0KsEQyl7qtK":3},"flags":{"world":{"sizes":"0.39","poder":{"foo":"$350","bar":"$540","zip":"$400"}},"gurps-instant-defaults":{"sizes":""},"core":{"sourceId":"Macro.S5hjkNBOiqdm8lmb"},"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"gurps","systemVersion":"0.15.28","coreVersion":"10.291","createdTime":1665459890841,"modifiedTime":1676390644799,"lastModifiedBy":"oB3qR0KsEQyl7qtK"},"folder":null,"sort":0,"_id":"WOR1FuTouxatqVwz"}
